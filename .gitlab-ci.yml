# version 0.0.1

# Run before each script
before_script:
#  - docker info

types:
  - build

#build_image:
#  type: build
#  script:
#    - docker build -t ubuntu:14:04
#    - docker run ubuntu:14:04 apt-get install git

# Image host voulume definition:
# /path/to/bind/from/host:/path/to/bind/in/container:rw
    
# Build    
job_ubuntu:
  type: build
  image: ubuntu_teonet
  #volumes (defined in /etc/gitlab-runner/config.toml): /home/kirill/_repo_:/builds/ksnet/repo:rw
  script:
    # Test volumes
    #- cp ./autogen.sh ../repo
    #- printenv
    # Make  
    #- sh/build-ubuntu.sh
    #- pwd
    - ./autogen.sh
    - make
    - app/teovpn -?
    # Build package
    #- sh/make_package deb
  only:
    - master
    
job_centos:
  type: build
  image: centos_teonet
  script:
    #- sh/build-centos.sh
    - ./autogen.sh
    - make
    - app/teovpn -?
  only:
    - master    

job_fedora:
  type: build
  image: fedora_teonet
  script:
    #- sh/build-centos.sh
    - ./autogen.sh
    - make
    - app/teovpn -?
  only:
    - master
    
# Test

# Deploy
job_ubuntu:
  type: deploy
  image: ubuntu_teonet
  script:
    # Build DEB package and upload it to repository
    - sh/make_package deb
  only:
    - master
    